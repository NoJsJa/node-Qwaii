function articleInit(){function t(){var t=$(this).scrollTop(),e=$(document).height(),n=$(this).height();e!=t+n||pageAction.commentLoaded||(pageAction.commentLoaded=!0,pageAction.getUpAndDown(),pageAction.getArticleInfo())}pageAction.title=$("#articleTitle").text(),pageAction.author=$("#articleAuthor").text(),$("#up").click(function(){var t=this;pageAction.upOrDown(t)}),$("#down").click(function(){var t=this;pageAction.upOrDown(t)}),$("#makeComment span").click(function(){pageAction.insertComment()}),$(window).scroll(t),setTimeout(t,3e3)}define("article",["jquery"],function(){return{articleInit:articleInit,getContent:function(){pageAction.getContent()},updateReadNumber:function(){pageAction.updateReadNumber()},getBackgroundImg:function(){$("#backgroundImg").prop("class","background-img")}}});var pageAction={title:null,author:null,commentLoaded:!1};pageAction.modalWindow=function(t){$(".modal-body").text(t),$("#modalWindow").modal("show",{backdrop:!0,keyboard:!0})},pageAction.upOrDown=function(t){var e;e=t==document.getElementById("up")?"up":"down",$.post("/article/upOrDown",{action:e,title:$("#articleTitle").text(),author:$("#articleAuthor").text()},function(t){t.err?pageAction.modalWindow(t.statusText):pageAction.getUpAndDown()},"JSON")},pageAction.getUpAndDown=function(){$.post("/article/readUpAndDown",{title:$("#articleTitle").text(),author:$("#articleAuthor").text()},function(t){t.err?(pageAction.commentLoaded=!1,pageAction.modalWindow(t.statusText)):($("#up span").text(t.up),$("#down span").text(t.down),t.isUp&&null!==t.isUp?$("#up .badge").css({"background-color":"green"}):t.isDown&&null!==t.isDown&&$("#down .badge").css({"background-color":"green"}))},"JSON")},pageAction.getContent=function(){var t=[];t.push("/article/",this.author,"/",this.title),$.post(t.join(""),{action:"getContent"},function(t){if(t.status){if($("#articleContent").append($(t.article.content)),"bilibili"==t.article.from){var e="http://www.bilibili.com/html/player.html?aid="+t.article.source;$("#articleContent").append($('<iframe class="bili-video" frameborder="0" allowfullscreen="" scrolling="no"></iframe>').prop("src",e))}$("img").lazyload({effect:"fadeIn"})}else pageAction.commentLoaded=!1,pageAction.modalWindow("读取出错!")},"JSON")},pageAction.getArticleInfo=function(){var t=[];t.push("/article/",this.author,"/",this.title),$.post(t.join(""),{action:"getInfo"},function(t){if(t.status){$(".comments-wrapper").children('div[class!="comment-label"]').remove();var e=JSON.parse(t.commentsData);$("#up > span").text(e.up),$("#down > span").text(e.down),$.each(e.comments,function(t,e){var n=$('<div class="entry-comments"></div>'),o=$("<label></label>");o.text(e.commentator+":"),o.appendTo(n);var i=$("<label></label></br>");i.text(e.content),i.appendTo(n);var a=$("<label></label>");a.text(e.date),a.appendTo(n),n.appendTo($(".comments-wrapper"))})}else pageAction.modalWindow("读取评论出错!")},"JSON")},pageAction.insertComment=function(){var t=$("#makeComment input").val(),e=this.title,n=this.author;return t?void $.post("/article/makeComment",{content:t,articleTitle:e,articleAuthor:n},function(t){t.err?pageAction.modalWindow(t.statusText):pageAction.getArticleInfo()},"JSON"):this.modalWindow("你还没有输入评论内容!")},pageAction.updateReadNumber=function(){var t=[];t.push("/article/",this.author,"/",this.title),$.post(t.join(""),{action:"updateRead"})};